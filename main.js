(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}t.d({},{D:()=>P,J:()=>m});var n=function(t){return fetch("".concat(P.url,"/cards/").concat(t),{method:"DELETE",headers:{authorization:P.headers.authorization,"Content-Type":P.headers["Content-Type"]}}).then(e).catch((function(t){console.log("Ошибка: ".concat(t.status))}))},o=function(t){return fetch("".concat(P.url,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:P.headers.authorization,"Content-Type":P.headers["Content-Type"]}}).then(e)},c=function(t){return fetch("".concat(P.url,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:P.headers.authorization,"Content-Type":P.headers["Content-Type"]}}).then(e)},r=document.querySelector("#card-template").content;function a(t,e){var a=r.cloneNode(!0),u=a.querySelector(".card"),i=a.querySelector(".card__delete-button"),s=a.querySelector(".card__image"),l=a.querySelector(".card__title"),d=a.querySelector(".card__like-button"),p=a.querySelector(".card__like-container_number");return l.textContent=t.name,s.src=t.link,s.alt=t.name,p.textContent=t.likes.length,d.addEventListener("click",(function(){!function(t,e,n){t.classList.contains("card__like-button_is-active")?c(n).then((function(n){e.textContent=n.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){console.log("Ошибка: ".concat(t.status))})):o(n).then((function(n){e.textContent=n.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(t){console.log("Ошибка: ".concat(t.status))}))}(d,p,t._id)})),t.likes.some((function(t){return t._id===m}))&&d.classList.add("card__like-button_is-active"),t.owner._id!==m&&i.remove(),i.addEventListener("click",(function(){!function(t,e){n(e).then((function(){t.remove()})).catch((function(t){console.log("Ошибка: ".concat(t.status))}))}(u,t._id)})),s.addEventListener("click",(function(){e(t)})),a}function u(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function i(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)}function s(t){"Escape"===t.key&&i(document.querySelector(".popup_is-opened"))}var l=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)};function d(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}var p=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));d(n,t.querySelector(e.submitButtonSelector),e),n.forEach((function(n){l(t,n,e)}))},f=document.querySelector(".popup_type_edit"),_=document.querySelector(".profile__edit-button"),h=f.querySelector(".popup__input_type_name"),y=f.querySelector(".popup__input_type_description"),m="",v=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),q=document.querySelector(".places__list"),b=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_avatar"),L=document.querySelector(".popup__input_type_avatar"),g=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__image"),x=document.querySelector(".popup__caption"),z=document.querySelector(".popup__input_type_url"),A=document.querySelector(".profile__add-button"),P={url:"https://mesto.nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"d3146c36-d302-4c3a-a516-c0ba96e51301","Content-Type":"application/json"}},w=[fetch("".concat(P.url,"/users/me"),{headers:P.headers}).then(e).catch((function(t){console.log("Ошибка: ".concat(t.status))})),fetch("".concat(P.url,"/cards"),{headers:P.headers}).then(e).catch((function(t){console.log("Ошибка: ".concat(t.status))}))],B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function O(t){x.textContent=t.name,T.alt=t.name,T.src=t.link,u(k)}function D(t,e){t.querySelector(B.submitButtonSelector).textContent=e}document.querySelectorAll(".popup").forEach((function(t){var e;(e=t).querySelector(".popup__close").addEventListener("click",(function(){i(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&i(e)}))})),b.addEventListener("submit",(function(t){!function(t){t.preventDefault(),D(b,"Сохранение...");var n={};n.name=g.value,n.link=z.value,function(t){return fetch("".concat(P.url,"/cards"),{method:"POST",body:JSON.stringify({name:t.name,link:t.link}),headers:{authorization:P.headers.authorization,"Content-Type":P.headers["Content-Type"]}}).then(e).catch((function(t){console.log("Ошибка: ".concat(t.status))}))}(n).then((function(t){q.prepend(a(t,O)),g.value="",z.value="",i(b)})).catch((function(t){console.log("Ошибка: ".concat(t.status))})).finally((function(){D(b,"Сохранить")}))}(t)})),f.addEventListener("submit",(function(t){!function(t){var n,o;t.preventDefault(),D(f,"Сохранение..."),v.textContent=h.value,S.textContent=y.value,(n=v.textContent,o=S.textContent,fetch("".concat(P.url,"/users/me"),{method:"PATCH",headers:{authorization:P.headers.authorization,"Content-Type":P.headers["Content-Type"]},body:JSON.stringify({name:n,about:o})}).then(e)).then((function(){i(f)})).catch((function(t){console.log("Ошибка: ".concat(t.status))})).finally((function(){D(f,"Сохранить")}))}(t)})),C.addEventListener("click",(function(){u(E),p(E,B)})),A.addEventListener("click",(function(){u(b),p(b,B)})),_.addEventListener("click",(function(){h.value=v.textContent,y.value=S.textContent,u(f),p(f,B)})),E.addEventListener("submit",(function(t){!function(t){var n;t.preventDefault(),D(E,"Сохранение..."),(n=L.value,fetch("".concat(P.url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:P.headers.authorization,"Content-Type":P.headers["Content-Type"]},body:JSON.stringify({avatar:n})}).then(e)).then((function(t){C.style.backgroundImage='url("'.concat(t.avatar,'")'),L.value="",i(E)})).catch((function(t){console.log("Ошибка: ".concat(t.status))})).finally((function(){D(E,"Сохранить")}))}(t)})),Promise.all(w).then((function(t){v.textContent=t[0].name,S.textContent=t[0].about,C.style.backgroundImage='url("'.concat(t[0].avatar,'")'),m=t[0]._id,t[1].forEach((function(t){q.append(a(t,O))}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o,e),n.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,n):function(t,e,n,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,c,e),d(n,o,e)}))}))}(e,t)}))}(B)})();